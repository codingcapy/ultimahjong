var ye=t=>{throw TypeError(t)};var se=(t,e,s)=>e.has(t)||ye("Cannot "+s);var r=(t,e,s)=>(se(t,e,"read from private field"),s?s.call(t):e.get(t)),g=(t,e,s)=>e.has(t)?ye("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,s),d=(t,e,s,i)=>(se(t,e,"write to private field"),i?i.call(t,s):e.set(t,s),s),p=(t,e,s)=>(se(t,e,"access private method"),s);import{S as Qe,p as be,e as E,s as re,f as H,n as ie,i as ae,g as xe,t as De,h as ke,k as Me,l as ve,m as Se,r as v,o as Fe,q as Z,v as me,w as ee,u as Ee,a as Ne,j as a,b as Ie,L as Le,c as Ue}from"./index-BTrRufy2.js";import{I as Ge,u as Ae,T as Pe}from"./TopNav-gD81EJmv.js";var j,n,V,x,k,A,N,I,$,P,_,M,F,O,B,h,K,ne,oe,ce,le,he,ue,de,Oe,Ce,_e=(Ce=class extends Qe{constructor(e,s){super();g(this,h);g(this,j);g(this,n);g(this,V);g(this,x);g(this,k);g(this,A);g(this,N);g(this,I);g(this,$);g(this,P);g(this,_);g(this,M);g(this,F);g(this,O);g(this,B,new Set);this.options=s,d(this,j,e),d(this,I,null),d(this,N,be()),this.options.experimental_prefetchInRender||r(this,N).reject(new Error("experimental_prefetchInRender feature flag is not enabled")),this.bindMethods(),this.setOptions(s)}bindMethods(){this.refetch=this.refetch.bind(this)}onSubscribe(){this.listeners.size===1&&(r(this,n).addObserver(this),we(r(this,n),this.options)?p(this,h,K).call(this):this.updateResult(),p(this,h,le).call(this))}onUnsubscribe(){this.hasListeners()||this.destroy()}shouldFetchOnReconnect(){return fe(r(this,n),this.options,this.options.refetchOnReconnect)}shouldFetchOnWindowFocus(){return fe(r(this,n),this.options,this.options.refetchOnWindowFocus)}destroy(){this.listeners=new Set,p(this,h,he).call(this),p(this,h,ue).call(this),r(this,n).removeObserver(this)}setOptions(e){const s=this.options,i=r(this,n);if(this.options=r(this,j).defaultQueryOptions(e),this.options.enabled!==void 0&&typeof this.options.enabled!="boolean"&&typeof this.options.enabled!="function"&&typeof E(this.options.enabled,r(this,n))!="boolean")throw new Error("Expected enabled to be a boolean or a callback that returns a boolean");p(this,h,de).call(this),r(this,n).setOptions(this.options),s._defaulted&&!re(this.options,s)&&r(this,j).getQueryCache().notify({type:"observerOptionsUpdated",query:r(this,n),observer:this});const o=this.hasListeners();o&&je(r(this,n),i,this.options,s)&&p(this,h,K).call(this),this.updateResult(),o&&(r(this,n)!==i||E(this.options.enabled,r(this,n))!==E(s.enabled,r(this,n))||H(this.options.staleTime,r(this,n))!==H(s.staleTime,r(this,n)))&&p(this,h,ne).call(this);const c=p(this,h,oe).call(this);o&&(r(this,n)!==i||E(this.options.enabled,r(this,n))!==E(s.enabled,r(this,n))||c!==r(this,O))&&p(this,h,ce).call(this,c)}getOptimisticResult(e){const s=r(this,j).getQueryCache().build(r(this,j),e),i=this.createResult(s,e);return qe(this,i)&&(d(this,x,i),d(this,A,this.options),d(this,k,r(this,n).state)),i}getCurrentResult(){return r(this,x)}trackResult(e,s){return new Proxy(e,{get:(i,o)=>(this.trackProp(o),s==null||s(o),Reflect.get(i,o))})}trackProp(e){r(this,B).add(e)}getCurrentQuery(){return r(this,n)}refetch({...e}={}){return this.fetch({...e})}fetchOptimistic(e){const s=r(this,j).defaultQueryOptions(e),i=r(this,j).getQueryCache().build(r(this,j),s);return i.fetch().then(()=>this.createResult(i,s))}fetch(e){return p(this,h,K).call(this,{...e,cancelRefetch:e.cancelRefetch??!0}).then(()=>(this.updateResult(),r(this,x)))}createResult(e,s){var ge;const i=r(this,n),o=this.options,c=r(this,x),l=r(this,k),w=r(this,A),y=e!==i?e.state:r(this,V),{state:T}=e;let u={...T},L=!1,m;if(s._optimisticResults){const R=this.hasListeners(),Y=!R&&we(e,s),G=R&&je(e,i,s,o);(Y||G)&&(u={...u,...Me(T.data,e.options)}),s._optimisticResults==="isRestoring"&&(u.fetchStatus="idle")}let{error:Q,errorUpdatedAt:D,status:b}=u;m=u.data;let U=!1;if(s.placeholderData!==void 0&&m===void 0&&b==="pending"){let R;c!=null&&c.isPlaceholderData&&s.placeholderData===(w==null?void 0:w.placeholderData)?(R=c.data,U=!0):R=typeof s.placeholderData=="function"?s.placeholderData((ge=r(this,_))==null?void 0:ge.state.data,r(this,_)):s.placeholderData,R!==void 0&&(b="success",m=ve(c==null?void 0:c.data,R,s),L=!0)}if(s.select&&m!==void 0&&!U)if(c&&m===(l==null?void 0:l.data)&&s.select===r(this,$))m=r(this,P);else try{d(this,$,s.select),m=s.select(m),m=ve(c==null?void 0:c.data,m,s),d(this,P,m),d(this,I,null)}catch(R){d(this,I,R)}r(this,I)&&(Q=r(this,I),m=r(this,P),D=Date.now(),b="error");const q=u.fetchStatus==="fetching",z=b==="pending",W=b==="error",C=z&&q,J=m!==void 0,S={status:b,fetchStatus:u.fetchStatus,isPending:z,isSuccess:b==="success",isError:W,isInitialLoading:C,isLoading:C,data:m,dataUpdatedAt:u.dataUpdatedAt,error:Q,errorUpdatedAt:D,failureCount:u.fetchFailureCount,failureReason:u.fetchFailureReason,errorUpdateCount:u.errorUpdateCount,isFetched:u.dataUpdateCount>0||u.errorUpdateCount>0,isFetchedAfterMount:u.dataUpdateCount>y.dataUpdateCount||u.errorUpdateCount>y.errorUpdateCount,isFetching:q,isRefetching:q&&!z,isLoadingError:W&&!J,isPaused:u.fetchStatus==="paused",isPlaceholderData:L,isRefetchError:W&&J,isStale:pe(e,s),refetch:this.refetch,promise:r(this,N)};if(this.options.experimental_prefetchInRender){const R=X=>{S.status==="error"?X.reject(S.error):S.data!==void 0&&X.resolve(S.data)},Y=()=>{const X=d(this,N,S.promise=be());R(X)},G=r(this,N);switch(G.status){case"pending":e.queryHash===i.queryHash&&R(G);break;case"fulfilled":(S.status==="error"||S.data!==G.value)&&Y();break;case"rejected":(S.status!=="error"||S.error!==G.reason)&&Y();break}}return S}updateResult(){const e=r(this,x),s=this.createResult(r(this,n),this.options);if(d(this,k,r(this,n).state),d(this,A,this.options),r(this,k).data!==void 0&&d(this,_,r(this,n)),re(s,e))return;d(this,x,s);const i=()=>{if(!e)return!0;const{notifyOnChangeProps:o}=this.options,c=typeof o=="function"?o():o;if(c==="all"||!c&&!r(this,B).size)return!0;const l=new Set(c??r(this,B));return this.options.throwOnError&&l.add("error"),Object.keys(r(this,x)).some(w=>{const f=w;return r(this,x)[f]!==e[f]&&l.has(f)})};p(this,h,Oe).call(this,{listeners:i()})}onQueryUpdate(){this.updateResult(),this.hasListeners()&&p(this,h,le).call(this)}},j=new WeakMap,n=new WeakMap,V=new WeakMap,x=new WeakMap,k=new WeakMap,A=new WeakMap,N=new WeakMap,I=new WeakMap,$=new WeakMap,P=new WeakMap,_=new WeakMap,M=new WeakMap,F=new WeakMap,O=new WeakMap,B=new WeakMap,h=new WeakSet,K=function(e){p(this,h,de).call(this);let s=r(this,n).fetch(this.options,e);return e!=null&&e.throwOnError||(s=s.catch(ie)),s},ne=function(){p(this,h,he).call(this);const e=H(this.options.staleTime,r(this,n));if(ae||r(this,x).isStale||!xe(e))return;const i=De(r(this,x).dataUpdatedAt,e)+1;d(this,M,setTimeout(()=>{r(this,x).isStale||this.updateResult()},i))},oe=function(){return(typeof this.options.refetchInterval=="function"?this.options.refetchInterval(r(this,n)):this.options.refetchInterval)??!1},ce=function(e){p(this,h,ue).call(this),d(this,O,e),!(ae||E(this.options.enabled,r(this,n))===!1||!xe(r(this,O))||r(this,O)===0)&&d(this,F,setInterval(()=>{(this.options.refetchIntervalInBackground||ke.isFocused())&&p(this,h,K).call(this)},r(this,O)))},le=function(){p(this,h,ne).call(this),p(this,h,ce).call(this,p(this,h,oe).call(this))},he=function(){r(this,M)&&(clearTimeout(r(this,M)),d(this,M,void 0))},ue=function(){r(this,F)&&(clearInterval(r(this,F)),d(this,F,void 0))},de=function(){const e=r(this,j).getQueryCache().build(r(this,j),this.options);if(e===r(this,n))return;const s=r(this,n);d(this,n,e),d(this,V,e.state),this.hasListeners()&&(s==null||s.removeObserver(this),e.addObserver(this))},Oe=function(e){Se.batch(()=>{e.listeners&&this.listeners.forEach(s=>{s(r(this,x))}),r(this,j).getQueryCache().notify({query:r(this,n),type:"observerResultsUpdated"})})},Ce);function Be(t,e){return E(e.enabled,t)!==!1&&t.state.data===void 0&&!(t.state.status==="error"&&e.retryOnMount===!1)}function we(t,e){return Be(t,e)||t.state.data!==void 0&&fe(t,e,e.refetchOnMount)}function fe(t,e,s){if(E(e.enabled,t)!==!1&&H(e.staleTime,t)!=="static"){const i=typeof s=="function"?s(t):s;return i==="always"||i!==!1&&pe(t,e)}return!1}function je(t,e,s,i){return(t!==e||E(i.enabled,t)===!1)&&(!s.suspense||t.state.status!=="error")&&pe(t,s)}function pe(t,e){return E(e.enabled,t)!==!1&&t.isStaleByTime(H(e.staleTime,t))}function qe(t,e){return!re(t.getCurrentResult(),e)}var Te=v.createContext(!1),ze=()=>v.useContext(Te);Te.Provider;function We(){let t=!1;return{clearReset:()=>{t=!1},reset:()=>{t=!0},isReset:()=>t}}var Ke=v.createContext(We()),He=()=>v.useContext(Ke),Ve=(t,e)=>{(t.suspense||t.throwOnError||t.experimental_prefetchInRender)&&(e.isReset()||(t.retryOnMount=!1))},$e=t=>{v.useEffect(()=>{t.clearReset()},[t])},Je=({result:t,errorResetBoundary:e,throwOnError:s,query:i,suspense:o})=>t.isError&&!e.isReset()&&!t.isFetching&&i&&(o&&t.data===void 0||Fe(s,[t.error,i])),Ye=t=>{if(t.suspense){const e=i=>i==="static"?i:Math.max(i??1e3,1e3),s=t.staleTime;t.staleTime=typeof s=="function"?(...i)=>e(s(...i)):e(s),typeof t.gcTime=="number"&&(t.gcTime=Math.max(t.gcTime,1e3))}},Xe=(t,e)=>t.isLoading&&t.isFetching&&!e,Ze=(t,e)=>(t==null?void 0:t.suspense)&&e.isPending,Re=(t,e,s)=>e.fetchOptimistic(t).catch(()=>{s.clearReset()});function et(t,e,s){var u,L,m,Q,D;const i=ze(),o=He(),c=Z(),l=c.defaultQueryOptions(t);(L=(u=c.getDefaultOptions().queries)==null?void 0:u._experimental_beforeQuery)==null||L.call(u,l),l._optimisticResults=i?"isRestoring":"optimistic",Ye(l),Ve(l,o),$e(o);const w=!c.getQueryCache().get(l.queryHash),[f]=v.useState(()=>new e(c,l)),y=f.getOptimisticResult(l),T=!i&&t.subscribed!==!1;if(v.useSyncExternalStore(v.useCallback(b=>{const U=T?f.subscribe(Se.batchCalls(b)):ie;return f.updateResult(),U},[f,T]),()=>f.getCurrentResult(),()=>f.getCurrentResult()),v.useEffect(()=>{f.setOptions(l)},[l,f]),Ze(l,y))throw Re(l,f,o);if(Je({result:y,errorResetBoundary:o,throwOnError:l.throwOnError,query:c.getQueryCache().get(l.queryHash),suspense:l.suspense}))throw y.error;if((Q=(m=c.getDefaultOptions().queries)==null?void 0:m._experimental_afterQuery)==null||Q.call(m,l,y),l.experimental_prefetchInRender&&!ae&&Xe(y,i)){const b=w?Re(l,f,o):(D=c.getQueryCache().get(l.queryHash))==null?void 0:D.promise;b==null||b.catch(ie).finally(()=>{f.updateResult()})}return l.notifyOnChangeProps?y:f.trackResult(y)}function tt(t,e){return et(t,_e)}function te(t){return{...t,createdAt:new Date(t.createdAt)}}async function st(t){const e=await ee.api.games.$post({json:t});if(!e.ok){let i="There was an issue creating your game :( We'll look into it ASAP!";try{const o=await e.json();o&&typeof o=="object"&&"message"in o&&(i=String(o.message))}catch(o){console.error("Failed to parse error response:",o)}throw new Error(i)}const s=await e.json();if(!s.game)throw new Error("Invalid response from server");return te(s.game)}const rt=t=>{const e=Z();return me({mutationFn:st,onSettled:s=>{if(!s)return console.log(s,"create args, returning");e.invalidateQueries({queryKey:["games"]})},onError:s=>{}})};async function it(){const t=await ee.api.games.$get();if(!t.ok)throw new Error("Error getting games");const{games:e}=await t.json();return e.map(s=>te(s))}const at=()=>({queryKey:["games"],queryFn:()=>it()});async function nt(t){const e=await ee.api.games.delete.$post({json:t});if(!e.ok)throw new Error("Error deleting game.");const{game:s}=await e.json();return te(s)}const ot=()=>{const t=Z();return me({mutationFn:nt,onSettled:e=>{e&&(t.invalidateQueries({queryKey:["games"]}),t.invalidateQueries({queryKey:["games"]}))}})};async function ct(t){const e=await ee.api.games.update.$post({json:t});if(!e.ok)throw new Error("Error updating game.");const{game:s}=await e.json();return te(s)}const lt=()=>{const t=Z();return me({mutationFn:ct,onSettled:e=>{e&&(t.invalidateQueries({queryKey:["games"]}),t.invalidateQueries({queryKey:["games"]}))}})};function ht(){const t=Ee(),{logoutService:e,authLoading:s,user:i}=Ne(w=>w),{mutate:o}=rt();function c(){e(),t({to:"/"})}async function l(w){w.preventDefault(),o({year:"New Game"})}return a.jsxs("div",{className:"hidden w-[12%] h-screen bg-black text-white md:flex flex-col justify-between",children:[a.jsxs("div",{className:"pt-10 text-center",children:[a.jsx(Ie,{to:"/",className:"pt-10 text-center font-bold",children:"Ultimate MahJong"}),a.jsx("form",{onSubmit:l,children:a.jsx("button",{className:"m-10 py-2 px-5 bg-green-500 rounded",children:"New Game"})})]}),a.jsxs("div",{className:"flex p-10 pb-20 cursor-pointer",onClick:c,children:[a.jsx(Ge,{className:" py-1 w-[25px] h-[25px]"}),a.jsx("div",{className:"pl-2 py-0",children:"Logout"})]})]})}function ut(t){const{game:e}=t,[s,i]=v.useState(window.innerWidth<500),[o,c]=v.useState(!1),[l,w]=v.useState(!1),[f,y]=v.useState(!1),[T,u]=v.useState(e.year||""),{games:L,setGames:m,currentGameId:Q,setCurrentGameId:D}=Ae(C=>C),{mutate:b}=ot(),{mutate:U}=lt();function q(){c(!o)}async function z(C){C.preventDefault();const J=C.target.projecttitle.value;U({gameId:e.gameId,year:J})}async function W(C){C.preventDefault(),b({gameId:e.gameId||0})}return a.jsxs("div",{className:"relative",onClick:()=>{D(t.game.gameId),console.log(t.game.gameId),console.log(Q)},onMouseEnter:()=>window.innerWidth>500&&i(!0),onMouseLeave:()=>{window.innerWidth>500&&i(!1),window.innerWidth>500&&c(!1)},children:[f&&a.jsxs("div",{className:"fixed z-[201] py-5 px-2 md:px-5 rounded-lg bg-[#1A1A1A] top-[20%] md:top-[10%] left-[5%] md:left-[35%] flex flex-col w-[90%]",children:[a.jsx("div",{className:"text-xl py-5 font-bold ",children:"Delete For Eternity"}),a.jsxs("div",{className:"",children:["You are about to permanently delete"," ",a.jsx("span",{className:"text-[#D2B1FD]",children:t.game.year}),". This ",a.jsx("br",{})," game will be gone forever."]}),a.jsx("div",{className:"mx-auto py-2",children:a.jsxs("form",{onSubmit:W,children:[a.jsx("input",{name:"content",id:"content",defaultValue:"[this message was deleted]",className:"hidden"}),a.jsxs("div",{className:"flex md:pl-64",children:[a.jsx("button",{className:"md:block md:pb-1 edit-btn cursor-pointer px-5 py-2 md:my-2 mx-2 bg-[#BABABA] rounded hover:bg-[#fafafa] transition-all ease duration-300 text-black tracking-widest",onClick:()=>y(!1),children:"CANCEL"}),a.jsx("button",{className:"md:block delete-btn cursor-pointer px-5 py-2 md:my-2 bg-[#DD4B63] rounded hover:bg-red-600 transition-all ease duration-300 tracking-widest",children:"DELETE"})]})]})})]}),f&&a.jsx("div",{className:"fixed inset-0 bg-black z-[200] opacity-70",onClick:()=>y(!1)}),a.jsx(Ie,{to:"/record",children:a.jsx("div",{className:"py-10 bg-gray-600 text-center text-white my-2 md:my-0",children:t.game.year},t.game.gameId)}),s&&a.jsx("div",{className:"absolute right-0 top-0 p-3 cursor-pointer z-10",onClick:q,children:a.jsx(Le,{})}),o&&a.jsxs("div",{className:"absolute right-5 top-10 bg-[#242424] border border-[#373541] rounded-xl py-5 px-5 z-10",children:[a.jsx("div",{className:"pb-1 cursor-pointer",onClick:()=>w(!0),children:"Edit Game Name"}),l&&a.jsx("div",{children:a.jsxs("form",{onSubmit:z,className:"flex flex-col",children:[a.jsx("input",{name:"projecttitle",id:"projecttitle",type:"text",value:T,onChange:C=>u(C.target.value),className:"bg-transparent border border-[#373541] px-1"}),a.jsxs("div",{className:"flex",children:[a.jsx("button",{className:"pr-2",children:"Update"}),a.jsx("button",{className:"px-2",onClick:()=>w(!1),children:"Cancel"})]})]})}),a.jsx("div",{className:"flex my-2",children:a.jsx("div",{className:"text-[#D2B1FC] cursor-pointer",onClick:()=>y(!0),children:"Delete"})})]})]},t.game.gameId)}const yt=Ue("/dashboard")({component:dt});function dt(){const{user:t}=Ne(i=>i),e=Ee(),{data:s}=tt(at());return v.useEffect(()=>{t||e({to:"/"})},[t]),a.jsxs("main",{className:"flex-1 text-white",children:[a.jsx(Pe,{}),a.jsxs("div",{className:"flex",children:[a.jsx(ht,{}),a.jsx("div",{className:"w-[100%] bg-gray-700 h-screen p-10",children:a.jsx("div",{className:"md:grid grid-cols-5 gap-3",children:s&&s.map(i=>i.active&&a.jsx(ut,{game:i},i.gameId))})})]})]})}export{yt as Route};
