import{u as p,a as h,c as m,q as D,b as f,d as j,j as e,L as y,I,r as l,e as q,f as A,g as L,h as T,T as F}from"./index-BUhTWMBf.js";function u(t){return{...t,createdAt:new Date(t.createdAt)}}async function Q(t){const a=await m.api.games.$post({json:t});if(!a.ok){let n="There was an issue creating your game :( We'll look into it ASAP!";try{const r=await a.json();r&&typeof r=="object"&&"message"in r&&(n=String(r.message))}catch(r){console.error("Failed to parse error response:",r)}throw new Error(n)}const s=await a.json();if(!s.game)throw new Error("Invalid response from server");return u(s.game)}const B=t=>{const a=p();return h({mutationFn:Q,onSettled:s=>{if(!s)return console.log(s,"create args, returning");a.invalidateQueries({queryKey:["games"]})},onError:s=>{}})};async function K(){const t=await m.api.games.$get();if(!t.ok)throw new Error("Error getting games");const{games:a}=await t.json();return a.map(s=>u(s))}const z=()=>D({queryKey:["games"],queryFn:()=>K()});async function R(t){const a=await m.api.games.delete.$post({json:t});if(!a.ok)throw new Error("Error deleting game.");const{game:s}=await a.json();return u(s)}const W=()=>{const t=p();return h({mutationFn:R,onSettled:a=>{a&&(t.invalidateQueries({queryKey:["games"]}),t.invalidateQueries({queryKey:["games"]}))}})};async function O(t){const a=await m.api.games.update.$post({json:t});if(!a.ok)throw new Error("Error updating game.");const{game:s}=await a.json();return u(s)}const U=()=>{const t=p();return h({mutationFn:O,onSettled:a=>{a&&(t.invalidateQueries({queryKey:["games"]}),t.invalidateQueries({queryKey:["games"]}))}})};function $(){const t=f(),{logoutService:a,authLoading:s,user:n}=j(i=>i),{mutate:r}=B();function c(){a(),t({to:"/"})}async function g(i){i.preventDefault(),r({year:"New Game"})}return e.jsxs("div",{className:"hidden w-[12%] h-screen bg-black text-white md:flex flex-col justify-between",children:[e.jsxs("div",{className:"pt-10 text-center",children:[e.jsx(y,{to:"/",className:"pt-10 text-center font-bold",children:"Ultimate MahJong"}),e.jsx("form",{onSubmit:g,children:e.jsx("button",{className:"m-10 py-2 px-5 bg-green-500 rounded",children:"New Game"})})]}),e.jsxs("div",{className:"flex p-10 pb-20 cursor-pointer",onClick:c,children:[e.jsx(I,{className:" py-1 w-[25px] h-[25px]"}),e.jsx("div",{className:"pl-2 py-0",children:"Logout"})]})]})}function P(t){const{game:a}=t,[s,n]=l.useState(window.innerWidth<500),[r,c]=l.useState(!1),[g,i]=l.useState(!1),[x,d]=l.useState(!1),[w,v]=l.useState(a.year||""),{games:_,setGames:J,currentGameId:b,setCurrentGameId:N}=q(o=>o),{mutate:E}=W(),{mutate:C}=U();function k(){c(!r)}async function G(o){o.preventDefault();const M=o.target.projecttitle.value;C({gameId:a.gameId,year:M})}async function S(o){o.preventDefault(),E({gameId:a.gameId||0})}return e.jsxs("div",{className:"relative",onClick:()=>{N(t.game.gameId),console.log(t.game.gameId),console.log(b)},onMouseEnter:()=>window.innerWidth>500&&n(!0),onMouseLeave:()=>{window.innerWidth>500&&n(!1),window.innerWidth>500&&c(!1)},children:[x&&e.jsxs("div",{className:"fixed z-[201] py-5 px-2 md:px-5 rounded-lg bg-[#1A1A1A] top-[20%] md:top-[10%] left-[5%] md:left-[35%] flex flex-col w-[90%]",children:[e.jsx("div",{className:"text-xl py-5 font-bold ",children:"Delete For Eternity"}),e.jsxs("div",{className:"",children:["You are about to permanently delete"," ",e.jsx("span",{className:"text-[#D2B1FD]",children:t.game.year}),". This ",e.jsx("br",{})," game will be gone forever."]}),e.jsx("div",{className:"mx-auto py-2",children:e.jsxs("form",{onSubmit:S,children:[e.jsx("input",{name:"content",id:"content",defaultValue:"[this message was deleted]",className:"hidden"}),e.jsxs("div",{className:"flex md:pl-64",children:[e.jsx("button",{className:"md:block md:pb-1 edit-btn cursor-pointer px-5 py-2 md:my-2 mx-2 bg-[#BABABA] rounded hover:bg-[#fafafa] transition-all ease duration-300 text-black tracking-widest",onClick:()=>d(!1),children:"CANCEL"}),e.jsx("button",{className:"md:block delete-btn cursor-pointer px-5 py-2 md:my-2 bg-[#DD4B63] rounded hover:bg-red-600 transition-all ease duration-300 tracking-widest",children:"DELETE"})]})]})})]}),x&&e.jsx("div",{className:"fixed inset-0 bg-black z-[200] opacity-70",onClick:()=>d(!1)}),e.jsx(y,{to:"/game",children:e.jsx("div",{className:"py-10 bg-gray-600 text-center text-white my-2 md:my-0",children:t.game.year},t.game.gameId)}),s&&e.jsx("div",{className:"absolute right-0 top-0 p-3 cursor-pointer z-10",onClick:k,children:e.jsx(A,{})}),r&&e.jsxs("div",{className:"absolute right-5 top-10 bg-[#242424] border border-[#373541] rounded-xl py-5 px-5 z-10",children:[e.jsx("div",{className:"pb-1 cursor-pointer",onClick:()=>i(!0),children:"Edit Game Name"}),g&&e.jsx("div",{children:e.jsxs("form",{onSubmit:G,className:"flex flex-col",children:[e.jsx("input",{name:"projecttitle",id:"projecttitle",type:"text",value:w,onChange:o=>v(o.target.value),className:"bg-transparent border border-[#373541] px-1"}),e.jsxs("div",{className:"flex",children:[e.jsx("button",{className:"pr-2",children:"Update"}),e.jsx("button",{className:"px-2",onClick:()=>i(!1),children:"Cancel"})]})]})}),e.jsx("div",{className:"flex my-2",children:e.jsx("div",{className:"text-[#D2B1FC] cursor-pointer",onClick:()=>d(!0),children:"Delete"})})]})]},t.game.gameId)}const H=L("/dashboard")({component:V});function V(){const{user:t}=j(n=>n),a=f(),{data:s}=T(z());return l.useEffect(()=>{t||a({to:"/"})},[t]),e.jsxs("main",{className:"flex-1 text-white",children:[e.jsx(F,{}),e.jsxs("div",{className:"flex",children:[e.jsx($,{}),e.jsx("div",{className:"w-[100%] bg-gray-700 h-screen p-10",children:e.jsx("div",{className:"md:grid grid-cols-5 gap-3",children:s&&s.map(n=>n.active&&e.jsx(P,{game:n},n.gameId))})})]})]})}export{H as Route};
