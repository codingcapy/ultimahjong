var fe=t=>{throw TypeError(t)};var Y=(t,e,s)=>e.has(t)||fe("Cannot "+s);var r=(t,e,s)=>(Y(t,e,"read from private field"),s?s.call(t):e.get(t)),g=(t,e,s)=>e.has(t)?fe("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,s),d=(t,e,s,i)=>(Y(t,e,"write to private field"),i?i.call(t,s):e.set(t,s),s),p=(t,e,s)=>(Y(t,e,"access private method"),s);import{S as Te,p as me,e as E,s as X,f as H,n as Z,i as ee,g as pe,t as De,h as Qe,k as ke,l as ge,m as we,r as R,o as Me,q as Re,v as Fe,w as je,u as Ce,a as Se,j as a,b as Ee,L as Le,c as Ue}from"./index-DGSVVev9.js";import{I as Ae,u as Pe,T as _e}from"./TopNav-kQNBHfII.js";var w,n,q,y,k,P,N,I,V,_,G,M,F,O,B,h,W,te,se,re,ie,ae,ne,oe,Ne,ve,Ge=(ve=class extends Te{constructor(e,s){super();g(this,h);g(this,w);g(this,n);g(this,q);g(this,y);g(this,k);g(this,P);g(this,N);g(this,I);g(this,V);g(this,_);g(this,G);g(this,M);g(this,F);g(this,O);g(this,B,new Set);this.options=s,d(this,w,e),d(this,I,null),d(this,N,me()),this.options.experimental_prefetchInRender||r(this,N).reject(new Error("experimental_prefetchInRender feature flag is not enabled")),this.bindMethods(),this.setOptions(s)}bindMethods(){this.refetch=this.refetch.bind(this)}onSubscribe(){this.listeners.size===1&&(r(this,n).addObserver(this),be(r(this,n),this.options)?p(this,h,W).call(this):this.updateResult(),p(this,h,ie).call(this))}onUnsubscribe(){this.hasListeners()||this.destroy()}shouldFetchOnReconnect(){return ce(r(this,n),this.options,this.options.refetchOnReconnect)}shouldFetchOnWindowFocus(){return ce(r(this,n),this.options,this.options.refetchOnWindowFocus)}destroy(){this.listeners=new Set,p(this,h,ae).call(this),p(this,h,ne).call(this),r(this,n).removeObserver(this)}setOptions(e){const s=this.options,i=r(this,n);if(this.options=r(this,w).defaultQueryOptions(e),this.options.enabled!==void 0&&typeof this.options.enabled!="boolean"&&typeof this.options.enabled!="function"&&typeof E(this.options.enabled,r(this,n))!="boolean")throw new Error("Expected enabled to be a boolean or a callback that returns a boolean");p(this,h,oe).call(this),r(this,n).setOptions(this.options),s._defaulted&&!X(this.options,s)&&r(this,w).getQueryCache().notify({type:"observerOptionsUpdated",query:r(this,n),observer:this});const o=this.hasListeners();o&&xe(r(this,n),i,this.options,s)&&p(this,h,W).call(this),this.updateResult(),o&&(r(this,n)!==i||E(this.options.enabled,r(this,n))!==E(s.enabled,r(this,n))||H(this.options.staleTime,r(this,n))!==H(s.staleTime,r(this,n)))&&p(this,h,te).call(this);const c=p(this,h,se).call(this);o&&(r(this,n)!==i||E(this.options.enabled,r(this,n))!==E(s.enabled,r(this,n))||c!==r(this,O))&&p(this,h,re).call(this,c)}getOptimisticResult(e){const s=r(this,w).getQueryCache().build(r(this,w),e),i=this.createResult(s,e);return ze(this,i)&&(d(this,y,i),d(this,P,this.options),d(this,k,r(this,n).state)),i}getCurrentResult(){return r(this,y)}trackResult(e,s){return new Proxy(e,{get:(i,o)=>(this.trackProp(o),s==null||s(o),Reflect.get(i,o))})}trackProp(e){r(this,B).add(e)}getCurrentQuery(){return r(this,n)}refetch({...e}={}){return this.fetch({...e})}fetchOptimistic(e){const s=r(this,w).defaultQueryOptions(e),i=r(this,w).getQueryCache().build(r(this,w),s);return i.fetch().then(()=>this.createResult(i,s))}fetch(e){return p(this,h,W).call(this,{...e,cancelRefetch:e.cancelRefetch??!0}).then(()=>(this.updateResult(),r(this,y)))}createResult(e,s){var de;const i=r(this,n),o=this.options,c=r(this,y),l=r(this,k),v=r(this,P),b=e!==i?e.state:r(this,q),{state:T}=e;let u={...T},L=!1,m;if(s._optimisticResults){const C=this.hasListeners(),K=!C&&be(e,s),A=C&&xe(e,i,s,o);(K||A)&&(u={...u,...ke(T.data,e.options)}),s._optimisticResults==="isRestoring"&&(u.fetchStatus="idle")}let{error:D,errorUpdatedAt:Q,status:x}=u;m=u.data;let U=!1;if(s.placeholderData!==void 0&&m===void 0&&x==="pending"){let C;c!=null&&c.isPlaceholderData&&s.placeholderData===(v==null?void 0:v.placeholderData)?(C=c.data,U=!0):C=typeof s.placeholderData=="function"?s.placeholderData((de=r(this,G))==null?void 0:de.state.data,r(this,G)):s.placeholderData,C!==void 0&&(x="success",m=ge(c==null?void 0:c.data,C,s),L=!0)}if(s.select&&m!==void 0&&!U)if(c&&m===(l==null?void 0:l.data)&&s.select===r(this,V))m=r(this,_);else try{d(this,V,s.select),m=s.select(m),m=ge(c==null?void 0:c.data,m,s),d(this,_,m),d(this,I,null)}catch(C){d(this,I,C)}r(this,I)&&(D=r(this,I),m=r(this,_),Q=Date.now(),x="error");const z=u.fetchStatus==="fetching",j=x==="pending",J=x==="error",he=j&&z,ue=m!==void 0,S={status:x,fetchStatus:u.fetchStatus,isPending:j,isSuccess:x==="success",isError:J,isInitialLoading:he,isLoading:he,data:m,dataUpdatedAt:u.dataUpdatedAt,error:D,errorUpdatedAt:Q,failureCount:u.fetchFailureCount,failureReason:u.fetchFailureReason,errorUpdateCount:u.errorUpdateCount,isFetched:u.dataUpdateCount>0||u.errorUpdateCount>0,isFetchedAfterMount:u.dataUpdateCount>b.dataUpdateCount||u.errorUpdateCount>b.errorUpdateCount,isFetching:z,isRefetching:z&&!j,isLoadingError:J&&!ue,isPaused:u.fetchStatus==="paused",isPlaceholderData:L,isRefetchError:J&&ue,isStale:le(e,s),refetch:this.refetch,promise:r(this,N)};if(this.options.experimental_prefetchInRender){const C=$=>{S.status==="error"?$.reject(S.error):S.data!==void 0&&$.resolve(S.data)},K=()=>{const $=d(this,N,S.promise=me());C($)},A=r(this,N);switch(A.status){case"pending":e.queryHash===i.queryHash&&C(A);break;case"fulfilled":(S.status==="error"||S.data!==A.value)&&K();break;case"rejected":(S.status!=="error"||S.error!==A.reason)&&K();break}}return S}updateResult(){const e=r(this,y),s=this.createResult(r(this,n),this.options);if(d(this,k,r(this,n).state),d(this,P,this.options),r(this,k).data!==void 0&&d(this,G,r(this,n)),X(s,e))return;d(this,y,s);const i=()=>{if(!e)return!0;const{notifyOnChangeProps:o}=this.options,c=typeof o=="function"?o():o;if(c==="all"||!c&&!r(this,B).size)return!0;const l=new Set(c??r(this,B));return this.options.throwOnError&&l.add("error"),Object.keys(r(this,y)).some(v=>{const f=v;return r(this,y)[f]!==e[f]&&l.has(f)})};p(this,h,Ne).call(this,{listeners:i()})}onQueryUpdate(){this.updateResult(),this.hasListeners()&&p(this,h,ie).call(this)}},w=new WeakMap,n=new WeakMap,q=new WeakMap,y=new WeakMap,k=new WeakMap,P=new WeakMap,N=new WeakMap,I=new WeakMap,V=new WeakMap,_=new WeakMap,G=new WeakMap,M=new WeakMap,F=new WeakMap,O=new WeakMap,B=new WeakMap,h=new WeakSet,W=function(e){p(this,h,oe).call(this);let s=r(this,n).fetch(this.options,e);return e!=null&&e.throwOnError||(s=s.catch(Z)),s},te=function(){p(this,h,ae).call(this);const e=H(this.options.staleTime,r(this,n));if(ee||r(this,y).isStale||!pe(e))return;const i=De(r(this,y).dataUpdatedAt,e)+1;d(this,M,setTimeout(()=>{r(this,y).isStale||this.updateResult()},i))},se=function(){return(typeof this.options.refetchInterval=="function"?this.options.refetchInterval(r(this,n)):this.options.refetchInterval)??!1},re=function(e){p(this,h,ne).call(this),d(this,O,e),!(ee||E(this.options.enabled,r(this,n))===!1||!pe(r(this,O))||r(this,O)===0)&&d(this,F,setInterval(()=>{(this.options.refetchIntervalInBackground||Qe.isFocused())&&p(this,h,W).call(this)},r(this,O)))},ie=function(){p(this,h,te).call(this),p(this,h,re).call(this,p(this,h,se).call(this))},ae=function(){r(this,M)&&(clearTimeout(r(this,M)),d(this,M,void 0))},ne=function(){r(this,F)&&(clearInterval(r(this,F)),d(this,F,void 0))},oe=function(){const e=r(this,w).getQueryCache().build(r(this,w),this.options);if(e===r(this,n))return;const s=r(this,n);d(this,n,e),d(this,q,e.state),this.hasListeners()&&(s==null||s.removeObserver(this),e.addObserver(this))},Ne=function(e){we.batch(()=>{e.listeners&&this.listeners.forEach(s=>{s(r(this,y))}),r(this,w).getQueryCache().notify({query:r(this,n),type:"observerResultsUpdated"})})},ve);function Be(t,e){return E(e.enabled,t)!==!1&&t.state.data===void 0&&!(t.state.status==="error"&&e.retryOnMount===!1)}function be(t,e){return Be(t,e)||t.state.data!==void 0&&ce(t,e,e.refetchOnMount)}function ce(t,e,s){if(E(e.enabled,t)!==!1&&H(e.staleTime,t)!=="static"){const i=typeof s=="function"?s(t):s;return i==="always"||i!==!1&&le(t,e)}return!1}function xe(t,e,s,i){return(t!==e||E(i.enabled,t)===!1)&&(!s.suspense||t.state.status!=="error")&&le(t,s)}function le(t,e){return E(e.enabled,t)!==!1&&t.isStaleByTime(H(e.staleTime,t))}function ze(t,e){return!X(t.getCurrentResult(),e)}var Ie=R.createContext(!1),We=()=>R.useContext(Ie);Ie.Provider;function He(){let t=!1;return{clearReset:()=>{t=!1},reset:()=>{t=!0},isReset:()=>t}}var qe=R.createContext(He()),Ve=()=>R.useContext(qe),Ke=(t,e)=>{(t.suspense||t.throwOnError||t.experimental_prefetchInRender)&&(e.isReset()||(t.retryOnMount=!1))},$e=t=>{R.useEffect(()=>{t.clearReset()},[t])},Je=({result:t,errorResetBoundary:e,throwOnError:s,query:i,suspense:o})=>t.isError&&!e.isReset()&&!t.isFetching&&i&&(o&&t.data===void 0||Me(s,[t.error,i])),Ye=t=>{if(t.suspense){const e=i=>i==="static"?i:Math.max(i??1e3,1e3),s=t.staleTime;t.staleTime=typeof s=="function"?(...i)=>e(s(...i)):e(s),typeof t.gcTime=="number"&&(t.gcTime=Math.max(t.gcTime,1e3))}},Xe=(t,e)=>t.isLoading&&t.isFetching&&!e,Ze=(t,e)=>(t==null?void 0:t.suspense)&&e.isPending,ye=(t,e,s)=>e.fetchOptimistic(t).catch(()=>{s.clearReset()});function et(t,e,s){var u,L,m,D,Q;const i=We(),o=Ve(),c=Re(),l=c.defaultQueryOptions(t);(L=(u=c.getDefaultOptions().queries)==null?void 0:u._experimental_beforeQuery)==null||L.call(u,l),l._optimisticResults=i?"isRestoring":"optimistic",Ye(l),Ke(l,o),$e(o);const v=!c.getQueryCache().get(l.queryHash),[f]=R.useState(()=>new e(c,l)),b=f.getOptimisticResult(l),T=!i&&t.subscribed!==!1;if(R.useSyncExternalStore(R.useCallback(x=>{const U=T?f.subscribe(we.batchCalls(x)):Z;return f.updateResult(),U},[f,T]),()=>f.getCurrentResult(),()=>f.getCurrentResult()),R.useEffect(()=>{f.setOptions(l)},[l,f]),Ze(l,b))throw ye(l,f,o);if(Je({result:b,errorResetBoundary:o,throwOnError:l.throwOnError,query:c.getQueryCache().get(l.queryHash),suspense:l.suspense}))throw b.error;if((D=(m=c.getDefaultOptions().queries)==null?void 0:m._experimental_afterQuery)==null||D.call(m,l,b),l.experimental_prefetchInRender&&!ee&&Xe(b,i)){const x=v?ye(l,f,o):(Q=c.getQueryCache().get(l.queryHash))==null?void 0:Q.promise;x==null||x.catch(Z).finally(()=>{f.updateResult()})}return l.notifyOnChangeProps?b:f.trackResult(b)}function tt(t,e){return et(t,Ge)}function Oe(t){return{...t,createdAt:new Date(t.createdAt)}}async function st(t){const e=await je.api.games.$post({json:t});if(!e.ok){let i="There was an issue creating your account :( We'll look into it ASAP!";try{const o=await e.json();o&&typeof o=="object"&&"message"in o&&(i=String(o.message))}catch(o){console.error("Failed to parse error response:",o)}throw new Error(i)}const s=await e.json();if(!s.game)throw new Error("Invalid response from server");return Oe(s.game)}const rt=t=>{const e=Re();return Fe({mutationFn:st,onSettled:s=>{if(!s)return console.log(s,"create args, returning");e.invalidateQueries({queryKey:["games"]})},onError:s=>{}})};async function it(){const t=await je.api.games.$get();if(!t.ok)throw new Error("Error getting chats by chatId");const{games:e}=await t.json();return e.map(s=>Oe(s))}const at=()=>({queryKey:["games"],queryFn:()=>it()});function nt(){const t=Ce(),{logoutService:e,authLoading:s,user:i}=Se(v=>v),{mutate:o}=rt();function c(){e(),t({to:"/"})}async function l(v){v.preventDefault(),o({year:"New Game"})}return a.jsxs("div",{className:"hidden w-[12%] h-screen bg-black text-white md:flex flex-col justify-between",children:[a.jsxs("div",{className:"pt-10 text-center",children:[a.jsx(Ee,{to:"/",className:"pt-10 text-center font-bold",children:"Ultimate MahJong"}),a.jsx("form",{onSubmit:l,children:a.jsx("button",{className:"m-10 py-2 px-5 bg-green-500 rounded",children:"New Game"})})]}),a.jsxs("div",{className:"flex p-10 pb-20 cursor-pointer",onClick:c,children:[a.jsx(Ae,{className:" py-1 w-[25px] h-[25px]"}),a.jsx("div",{className:"pl-2 py-0",children:"Logout"})]})]})}function ot(t){const{game:e}=t,[s,i]=R.useState(window.innerWidth<500),[o,c]=R.useState(!1),[l,v]=R.useState(!1),[f,b]=R.useState(!1),[T,u]=R.useState(e.year||""),{games:L,setGames:m,currentGameId:D,setCurrentGameId:Q}=Pe(j=>j);function x(){c(!o)}async function U(j){j.preventDefault(),j.target.projecttitle.value}async function z(j){j.preventDefault()}return a.jsxs("div",{className:"relative",onClick:()=>{Q(t.game.gameId),console.log(t.game.gameId),console.log(D)},onMouseEnter:()=>window.innerWidth>500&&i(!0),onMouseLeave:()=>{window.innerWidth>500&&i(!1),window.innerWidth>500&&c(!1)},children:[f&&a.jsxs("div",{className:"fixed z-[201] py-5 px-2 md:px-5 rounded-lg bg-[#1A1A1A] top-[20%] md:top-[10%] left-[5%] md:left-[35%] flex flex-col w-[90%]",children:[a.jsx("div",{className:"text-xl py-5 font-bold ",children:"Delete For Eternity"}),a.jsxs("div",{className:"",children:["You are about to permanently delete"," ",a.jsx("span",{className:"text-[#D2B1FD]",children:t.game.year}),". This ",a.jsx("br",{})," game will be gone forever."]}),a.jsx("div",{className:"mx-auto py-2",children:a.jsxs("form",{onSubmit:z,children:[a.jsx("input",{name:"content",id:"content",defaultValue:"[this message was deleted]",className:"hidden"}),a.jsxs("div",{className:"flex md:pl-64",children:[a.jsx("button",{className:"md:block md:pb-1 edit-btn cursor-pointer px-5 py-2 md:my-2 mx-2 bg-[#BABABA] rounded hover:bg-[#fafafa] transition-all ease duration-300 text-black tracking-widest",onClick:()=>b(!1),children:"CANCEL"}),a.jsx("button",{className:"md:block delete-btn cursor-pointer px-5 py-2 md:my-2 bg-[#DD4B63] rounded hover:bg-red-600 transition-all ease duration-300 tracking-widest",children:"DELETE"})]})]})})]}),f&&a.jsx("div",{className:"fixed inset-0 bg-black z-[200] opacity-70",onClick:()=>b(!1)}),a.jsx(Ee,{to:"/record",children:a.jsx("div",{className:"py-10 bg-gray-600 text-center text-white my-2 md:my-0",children:t.game.year},t.game.gameId)}),s&&a.jsx("div",{className:"absolute right-0 top-0 p-3 cursor-pointer z-10",onClick:x,children:a.jsx(Le,{})}),o&&a.jsxs("div",{className:"absolute right-5 top-10 bg-[#242424] border border-[#373541] rounded-xl py-5 px-5 z-10",children:[a.jsx("div",{className:"pb-1 cursor-pointer",onClick:()=>v(!0),children:"Edit Game Name"}),l&&a.jsx("div",{children:a.jsxs("form",{onSubmit:U,className:"flex flex-col",children:[a.jsx("input",{name:"projecttitle",id:"projecttitle",type:"text",value:T,onChange:j=>u(j.target.value),className:"bg-transparent border border-[#373541] px-1"}),a.jsxs("div",{className:"flex",children:[a.jsx("button",{className:"pr-2",children:"Update"}),a.jsx("button",{className:"px-2",onClick:()=>v(!1),children:"Cancel"})]})]})}),a.jsx("div",{className:"flex my-2",children:a.jsx("div",{className:"text-[#D2B1FC] cursor-pointer",onClick:()=>b(!0),children:"Delete"})})]})]},t.game.gameId)}const ft=Ue("/dashboard")({component:ct});function ct(){Se(e=>e),Ce();const{data:t}=tt(at());return a.jsxs("main",{className:"flex-1 text-white",children:[a.jsx(_e,{}),a.jsxs("div",{className:"flex",children:[a.jsx(nt,{}),a.jsx("div",{className:"w-[100%] bg-gray-700 h-screen p-10",children:a.jsx("div",{className:"md:grid grid-cols-5 gap-3",children:t&&t.map(e=>e.active&&a.jsx(ot,{game:e},e.gameId))})})]})]})}export{ft as Route};
